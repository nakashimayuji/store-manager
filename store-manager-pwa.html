<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>åº—é•·ã‚µãƒãƒ¼ãƒˆAI</title>

<!-- PWAè¨­å®š -->
<link rel="manifest" href="manifest.json" />
<style>
    body {
        font-family: "Helvetica Neue", Arial, sans-serif;
        background: #fff7fb;
        margin: 0;
        padding: 20px;
        text-align: center;
    }

    h1 {
        font-size: 26px;
        color: #ff7ab5;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .sub {
        font-size: 14px;
        color: #444;
        margin-bottom: 25px;
    }

    /* å¤§ããªä¸¸ã„ãƒœã‚¿ãƒ³ */
    .big-btn {
        background: linear-gradient(135deg, #ffb7d5, #ff7ab5);
        color: white;
        font-size: 20px;
        font-weight: bold;
        border: none;
        width: 85%;
        padding: 18px;
        margin: 15px auto;
        border-radius: 50px;
        display: block;
        box-shadow: 0 5px 12px rgba(255, 120, 180, 0.3);
        transition: 0.15s ease;
    }

    .big-btn:active {
        transform: scale(0.95);
    }

    /* å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ */
    input, select {
        width: 85%;
        font-size: 18px;
        padding: 12px;
        border: 2px solid #ffb7d5;
        border-radius: 15px;
        margin-bottom: 20px;
        background: #fff;
    }

    #result-box {
        margin-top: 25px;
        padding: 20px;
        background: #ffffff;
        border-radius: 20px;
        font-size: 18px;
        color: #444;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        display: none;
    }
</style>
</head>

<body>
<h1>åº—é•·ã‚µãƒãƒ¼ãƒˆAI</h1>
<div class="sub">ä»Šæ—¥ã‚‚ãŠç–²ã‚Œã•ã¾ã§ã™ ğŸ€</div>

<!-- ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<button class="big-btn" onclick="showStaffForm()">ğŸ‘¤ ãƒã‚¤ãƒˆã®å¾—æ„åˆ†é‡ ç™»éŒ²</button>
<button class="big-btn" onclick="showWorkloadForm()">ğŸ¢ ä»•è¾¼ã¿é‡ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹</button>
<button class="big-btn" onclick="showCongestionForm()">ğŸ‘€ æ··é›‘çŠ¶æ³ã‚’ã¿ã¦æŒ‡ç¤º</button>
<button class="big-btn" onclick="showStaffList()">ğŸ“‹ ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ / ä»Šæ—¥ã®ãƒ¡ãƒ³ãƒãƒ¼é¸æŠ</button>

<div id="input-area"></div>
<div id="result-box"></div>

<script>

/* --- UIç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•° --- */

function showStaffForm() {
    document.getElementById("input-area").innerHTML = `
        <h2>ğŸ‘¤ ãƒã‚¤ãƒˆæƒ…å ±ã‚’ç™»éŒ²</h2>
        <input id="name" placeholder="åå‰ã‚’å…¥åŠ›" />
        <div style="text-align:left; width:85%; margin:10px auto;">
            <label>ãƒ›ãƒ¼ãƒ«: </label>
            <select id="skill-hall">
                <option value="3">3ï¼ˆå¾—æ„ï¼‰</option>
                <option value="2">2ï¼ˆæ™®é€šï¼‰</option>
                <option value="1">1ï¼ˆè‹¦æ‰‹ï¼‰</option>
            </select>
            <br/><br/>
            <label>ç„¼ãé³¥: </label>
            <select id="skill-yakitori">
                <option value="3">3ï¼ˆå¾—æ„ï¼‰</option>
                <option value="2">2ï¼ˆæ™®é€šï¼‰</option>
                <option value="1">1ï¼ˆè‹¦æ‰‹ï¼‰</option>
            </select>
            <br/><br/>
            <label>ä¸€å“èª¿ç†: </label>
            <select id="skill-ippin">
                <option value="3">3ï¼ˆå¾—æ„ï¼‰</option>
                <option value="2">2ï¼ˆæ™®é€šï¼‰</option>
                <option value="1">1ï¼ˆè‹¦æ‰‹ï¼‰</option>
            </select>
            <br/><br/>
            <label>çš¿æ´—ã„: </label>
            <select id="skill-dish">
                <option value="3">3ï¼ˆå¾—æ„ï¼‰</option>
                <option value="2">2ï¼ˆæ™®é€šï¼‰</option>
                <option value="1">1ï¼ˆè‹¦æ‰‹ï¼‰</option>
            </select>
        </div>
        <button class="big-btn" onclick="saveStaff()">ç™»éŒ²ã™ã‚‹</button>
    `;
}

function showWorkloadForm() {
    document.getElementById("input-area").innerHTML = `
        <h2>ğŸ¢ ä»Šæ—¥ã®ä»•è¾¼ã¿é‡ã‚’è¨ºæ–­</h2>
        <input id="customers" type="number" placeholder="ä»Šæ—¥ã®äºˆæƒ³å®¢æ•°ã‚’å…¥åŠ›" />
        <button class="big-btn" onclick="calcWorkload()">AIã«è¨ºæ–­ã—ã¦ã‚‚ã‚‰ã†</button>
    `;
}

function showCongestionForm() {
    document.getElementById("input-area").innerHTML = `
        <h2>ğŸ‘€ æ··é›‘çŠ¶æ³ãƒã‚§ãƒƒã‚¯</h2>
        <input id="now" placeholder="ç¾åœ¨ã®å®¢æ•°ã‚’å…¥åŠ›" type="number" />
        <button class="big-btn" onclick="checkCongestion()">AIã«æŒ‡ç¤ºã‚’èã</button>
    `;
}

// ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ã¨ä»Šæ—¥ã®ãƒ¡ãƒ³ãƒãƒ¼é¸æŠ
function showStaffList() {
    let staff = JSON.parse(localStorage.getItem('staff') || '[]');
    let today = JSON.parse(localStorage.getItem('todayMembers') || '[]');

    let html = `<h2>ğŸ“‹ ç™»éŒ²ã‚¹ã‚¿ãƒƒãƒ•</h2>`;
    if (staff.length === 0) {
        html += `<div>ç™»éŒ²ã•ã‚ŒãŸã‚¹ã‚¿ãƒƒãƒ•ãŒã„ã¾ã›ã‚“ã€‚</div>`;
    } else {
        html += `<div style="display:flex;flex-direction:column;gap:12px; align-items:center;">
            `;
        staff.forEach(s => {
            let checked = today.includes(s.name) ? 'checked' : '';
            html += `
            <div style="width:85%; background:#fff; border-radius:12px; padding:12px; box-shadow:0 4px 10px rgba(0,0,0,0.04); text-align:left;">
                <label style="display:flex; align-items:center; gap:10px;">
                    <input type="checkbox" onchange="toggleTodayMember(this,'${s.name.replace(/'/g,"\\'") }')" ${checked} />
                    <strong>${s.name}</strong>
                </label>
                <div style="margin-top:8px; font-size:14px; color:#444;">
                    ãƒ›ãƒ¼ãƒ«: ${s.skills.hall} ï¼ ç„¼ãé³¥: ${s.skills.yakitori} ï¼ ä¸€å“: ${s.skills.ippin} ï¼ çš¿æ´—ã„: ${s.skills.dish}
                </div>
            </div>`;
        });
        html += `</div>`;
    }

    html += `<br/><button class="big-btn" onclick="saveTodayMembers()">ä»Šæ—¥ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ä¿å­˜</button>`;
    html += `<button class="big-btn" onclick="computeOptimalAssignment()">ğŸ¤– AIã§æœ€é©é…ç½®ã‚’æ±ºã‚ã‚‹</button>`;

    document.getElementById('input-area').innerHTML = html;
}

function toggleTodayMember(checkbox, name) {
    let today = JSON.parse(localStorage.getItem('todayMembers') || '[]');
    if (checkbox.checked) {
        if (!today.includes(name)) today.push(name);
    } else {
        today = today.filter(n => n !== name);
    }
    localStorage.setItem('todayMembers', JSON.stringify(today));
}

function saveTodayMembers() {
    // todayMembers already updated on toggle; just show confirmation
    let today = JSON.parse(localStorage.getItem('todayMembers') || '[]');
    if (today.length === 0) {
        showResult('ä»Šæ—¥ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
    } else {
        showResult('ä»Šæ—¥ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼š<br>' + today.join('ã€'));
    }
}

// ç°¡æ˜“AI: ä»Šæ—¥é¸ã°ã‚ŒãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’ã‚‚ã¨ã«ã€ãã®äººã”ã¨ã®æœ€é©å½¹å‰²ã‚’æ±ºã‚ã‚‹
function computeOptimalAssignment() {
    let staff = JSON.parse(localStorage.getItem('staff') || '[]');
    let today = JSON.parse(localStorage.getItem('todayMembers') || '[]');
    if (today.length === 0) {
        showResult('ä»Šæ—¥ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒé¸ã°ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšã€Œã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ã€ã§é¸æŠã—ã¦ãã ã•ã„ã€‚');
        return;
    }

    let members = staff.filter(s => today.includes(s.name));
    if (members.length === 0) {
        showResult('é¸æŠã•ã‚ŒãŸãƒ¡ãƒ³ãƒãƒ¼ãŒç™»éŒ²æƒ…å ±ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }

    // å„ãƒ¡ãƒ³ãƒãƒ¼ã®æœ€é©å½¹å‰²ã‚’æ±ºå®šï¼ˆæœ€å¤§è©•ä¾¡ã®å½¹å‰²ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼‰
    let assignments = members.map(m => {
        let skills = m.skills;
        let role = 'ãƒ›ãƒ¼ãƒ«';
        let max = skills.hall;
        if (skills.yakitori > max) { max = skills.yakitori; role = 'ç„¼ãé³¥'; }
        if (skills.ippin > max) { max = skills.ippin; role = 'ä¸€å“'; }
        if (skills.dish > max) { max = skills.dish; role = 'çš¿æ´—ã„'; }
        return {name: m.name, role: role, score: max};
    });

    // çµæœã‚’è¦‹ã‚„ã™ãè¡¨ç¤º
    let html = `<h3>æœ€é©é…ç½®ï¼ˆç°¡æ˜“AIï¼‰</h3>`;
    assignments.forEach(a => {
        html += `<div style="padding:8px 0;">${a.name} â†’ <b>${a.role}</b>ï¼ˆè©•ä¾¡ ${a.score}ï¼‰</div>`;
    });

    // å½¹å‰²ã”ã¨ã®äººæ•°é›†è¨ˆ
    let counts = assignments.reduce((acc, a) => { acc[a.role] = (acc[a.role]||0)+1; return acc; }, {});
    html += `<div style="margin-top:10px; font-size:14px; color:#444;">å½¹å‰²é›†è¨ˆï¼š`;
    for (let k in counts) html += ` ${k} ${counts[k]}å `;
    html += `</div>`;

    showResult(html);
}

/* --- ãƒã‚¤ãƒˆæƒ…å ±ã®ä¿å­˜ --- */
function saveStaff() {
    let name = document.getElementById("name").value;
    if (!name) {
        alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
        return;
    }

    // å„æŠ€èƒ½ã‚’3æ®µéšè©•ä¾¡ã§å–å¾—
    let hall = Number(document.getElementById("skill-hall").value);
    let yakitori = Number(document.getElementById("skill-yakitori").value);
    let ippin = Number(document.getElementById("skill-ippin").value);
    let dish = Number(document.getElementById("skill-dish").value);

    let skills = {
        hall: hall,
        yakitori: yakitori,
        ippin: ippin,
        dish: dish
    };

    let data = JSON.parse(localStorage.getItem("staff") || "[]");
    data.push({name: name, skills: skills});
    localStorage.setItem("staff", JSON.stringify(data));

    showResult(`${name} ã•ã‚“ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼<br><br>
        ãƒ›ãƒ¼ãƒ«: <b>${hall}</b> ï¼ ç„¼ãé³¥: <b>${yakitori}</b> ï¼ ä¸€å“: <b>${ippin}</b> ï¼ çš¿æ´—ã„: <b>${dish}</b>
    `);
}

/* --- ä»•è¾¼ã¿é‡ã®è¨ˆç®—ï¼ˆç°¡æ˜“AIï¼‰ --- */
function calcWorkload() {
    let n = Number(document.getElementById("customers").value);
    if (!n) {
        alert("äººæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
        return;
    }

    // ä»Šæ—¥ã¯èª°ãŒå…¥ã‚‹ã‹ã§ç„¼ãé³¥ãƒ»ä¸€å“ã®æº–å‚™é‡ã‚’èª¿æ•´
    let staff = JSON.parse(localStorage.getItem('staff') || '[]');
    let todayNames = JSON.parse(localStorage.getItem('todayMembers') || '[]');
    let members = staff.filter(s => todayNames.includes(s.name));

    // å¹³å‡ã‚¹ã‚­ãƒ«ã‚’è¨ˆç®—ï¼ˆå­˜åœ¨ã—ãªã‘ã‚Œã°ä¸­å¤®å€¤2ã‚’ä½¿ã†ï¼‰
    let avgYakitori = 2;
    let avgIppin = 2;
    if (members.length > 0) {
        avgYakitori = members.reduce((a,b)=>a+b.skills.yakitori,0)/members.length;
        avgIppin = members.reduce((a,b)=>a+b.skills.ippin,0)/members.length;
    }

    // ã‚¹ã‚­ãƒ«ã«ã‚ˆã‚‹èª¿æ•´ä¿‚æ•°ï¼ˆavg=2ã§1å€ã€avg=3ã§0.8å€ã€avg=1ã§1.2å€ã®ã‚ˆã†ãªç°¡æ˜“èª¿æ•´ï¼‰
    let yakitoriMultiplier = 1 + (2 - avgYakitori) * 0.2;
    let ippinMultiplier = 1 + (2 - avgIppin) * 0.15;

    let yakitori = Math.max(0, Math.round(n * 2.5 * yakitoriMultiplier));
    let ippin = Math.max(0, Math.round(n * 1.2 * ippinMultiplier));

    showResult(`
        ğŸ¢ ä»Šæ—¥ã®ä»•è¾¼ã¿ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆäºˆæƒ³å®¢æ•° ${n}äººï¼‰<br><br>
        ãƒ»ç„¼ãé³¥ï¼š<b>${yakitori}æœ¬</b>ï¼ˆã‚¹ã‚­ãƒ«è£œæ­£: ${yakitoriMultiplier.toFixed(2)}ï¼‰<br>
        ãƒ»ä¸€å“æ–™ç†ï¼š<b>${ippin}çš¿</b>ï¼ˆã‚¹ã‚­ãƒ«è£œæ­£: ${ippinMultiplier.toFixed(2)}ï¼‰
    `);
}

// æ··é›‘çŠ¶æ³ã‹ã‚‰ä»•è¾¼ã¿ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å‡ºã™ï¼ˆç¾åœ¨ã®å®¢æ•°ã‚’ãã®ã¾ã¾äºˆæƒ³å€¤ã¨ã—ã¦æ‰±ã†ç°¡æ˜“ç‰ˆï¼‰
function calcWorkloadFromCongestion(n) {
    // n: ç¾åœ¨å®¢æ•°ï¼ˆç°¡æ˜“çš„ã«ãã®ã¾ã¾äºˆæƒ³å®¢æ•°ã¨ã—ã¦æ‰±ã†ï¼‰
    // å†åˆ©ç”¨ã®ãŸã‚ã«è¨ˆç®—ã‚’åˆ†é›¢
    let staff = JSON.parse(localStorage.getItem('staff') || '[]');
    let todayNames = JSON.parse(localStorage.getItem('todayMembers') || '[]');
    let members = staff.filter(s => todayNames.includes(s.name));

    let avgYakitori = 2;
    let avgIppin = 2;
    if (members.length > 0) {
        avgYakitori = members.reduce((a,b)=>a+b.skills.yakitori,0)/members.length;
        avgIppin = members.reduce((a,b)=>a+b.skills.ippin,0)/members.length;
    }

    let yakitoriMultiplier = 1 + (2 - avgYakitori) * 0.2;
    let ippinMultiplier = 1 + (2 - avgIppin) * 0.15;

    let yakitori = Math.max(0, Math.round(n * 2.5 * yakitoriMultiplier));
    let ippin = Math.max(0, Math.round(n * 1.2 * ippinMultiplier));

    return {yakitori, ippin, yakitoriMultiplier: yakitoriMultiplier.toFixed(2), ippinMultiplier: ippinMultiplier.toFixed(2)};
}

/* --- æ··é›‘çŠ¶æ³ã®åˆ¤æ–­ --- */
function checkCongestion() {
    let n = Number(document.getElementById("now").value);

    if (!n) {
        alert("äººæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
        return;
    }

    let message = "";
    if (n < 15) {
        message = "ä»Šã¯è½ã¡ç€ã„ã¦ã„ã¾ã™ã€‚ã‚†ã£ãã‚Šå¯¾å¿œã§OKï¼ğŸ€";
    } else if (n < 30) {
        message = "å°‘ã—å¿™ã—ããªã£ã¦ãã¾ã—ãŸã€‚ãƒ›ãƒ¼ãƒ«å„ªå…ˆã§ï¼ğŸ’¨";
    } else {
        message = "æº€å¸­ã«è¿‘ã„ã§ã™ï¼ç„¼ãé³¥ã¨ä¸€å“ã‚’æœ€å„ªå…ˆã§å›ã—ã¾ã—ã‚‡ã†ï¼ğŸ”¥";
    }

    // æ··é›‘ã«å¿œã˜ãŸä»•è¾¼ã¿é‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚‚å‡ºã™
    let advice = calcWorkloadFromCongestion(n);
    message += `<br/><br/>ğŸ¢ æ¨å¥¨ä»•è¾¼ã¿ï¼ˆç¾åœ¨ã®å®¢æ•° ${n}äºº ã‚’åŸºæº–ï¼‰<br/>ãƒ»ç„¼ãé³¥ï¼š<b>${advice.yakitori}æœ¬</b>ï¼ˆè£œæ­£ ${advice.yakitoriMultiplier}ï¼‰<br/>ãƒ»ä¸€å“ï¼š<b>${advice.ippin}çš¿</b>ï¼ˆè£œæ­£ ${advice.ippinMultiplier}ï¼‰`;

    showResult(message);
}

/* --- çµæœè¡¨ç¤º --- */
function showResult(text) {
    let box = document.getElementById("result-box");
    box.innerHTML = text;
    box.style.display = "block";
}

</script>
</body>
</html>
